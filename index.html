<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿å¤§æŠ½å¥– - ç¯ç»•å¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            color: white;
            padding: 15px;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
        }
        
        .header {
            margin-bottom: 20px;
            padding: 20px;
        }
        
        h1 {
            font-size: clamp(24px, 5vw, 36px);
            margin-bottom: 10px;
            background: linear-gradient(to right, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: clamp(14px, 3vw, 18px);
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .music-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.5);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: clamp(14px, 3vw, 16px);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }
        
        .control-btn.active {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
        }
        
        .lottery-area {
            position: relative;
            width: min(95vw, 600px);
            height: min(95vw, 600px);
            margin: 0 auto 30px;
        }
        
        .prize-circle {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .prize-item {
            position: absolute;
            width: min(120px, 20vw);
            height: min(120px, 20vw);
            transition: all 0.3s ease;
        }
        
        .prize-item-inner {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            transform: translate(-50%, -50%);
        }
        
        .prize-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        
        .prize-item.active img {
            border-color: #FFD700;
            box-shadow: 0 0 20px #FFD700;
            transform: scale(1.1);
        }
        
        .prize-name {
            margin-top: 8px;
            font-size: clamp(12px, 2.5vw, 14px);
            background: rgba(0, 0, 0, 0.7);
            padding: 3px 8px;
            border-radius: 10px;
            white-space: nowrap;
            text-align: center;
        }
        
        .center-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }
        
        .lottery-btn {
            width: min(160px, 27vw);
            height: min(160px, 27vw);
            border-radius: 50%;
            background: linear-gradient(145deg, #FF416C, #FF4B2B);
            border: none;
            color: white;
            font-size: clamp(16px, 3vw, 20px);
            font-weight: bold;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .lottery-btn:hover:not(:disabled) {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 0 30px rgba(255, 65, 108, 0.6);
        }
        
        .lottery-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            background: linear-gradient(145deg, #666, #888);
        }
        
        .result-display {
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            max-width: 600px;
        }
        
        .result-text {
            font-size: clamp(18px, 4vw, 24px);
            margin-bottom: 15px;
            min-height: 40px;
        }
        
        .result-prize {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        @media (min-width: 768px) {
            .result-prize {
                flex-direction: row;
                justify-content: center;
            }
        }
        
        .result-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 12px;
            border: 2px solid #FFD700;
        }
        
        .winner-board {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .board-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        @media (min-width: 576px) {
            .board-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }
        
        .board-title {
            font-size: clamp(18px, 4vw, 20px);
            color: #FFD700;
        }
        
        .view-history-btn, .reset-btn {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: clamp(14px, 3vw, 16px);
            transition: all 0.3s;
        }
        
        .view-history-btn:hover, .reset-btn:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .winner-scroll {
            height: 200px;
            overflow: hidden;
            position: relative;
        }
        
        .winner-list {
            list-style: none;
        }
        
        .winner-list li {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            width: 100%;
            max-width: 500px;
            border-radius: 20px;
            padding: 30px;
            position: relative;
            border: 2px solid #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.4);
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: rotate(90deg);
        }
        
        /* ç­”é¢˜é¡µé¢æ ·å¼ */
        .quiz-container {
            text-align: center;
        }
        
        .quiz-title {
            color: #FFD700;
            font-size: 24px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF416C, #FF4B2B);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .quiz-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            font-size: 16px;
            color: #FFD700;
            padding: 0 10px;
        }
        
        .question-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            text-align: left;
            backdrop-filter: blur(10px);
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #fff;
            min-height: 60px;
        }
        
        .options-container {
            display: grid;
            gap: 12px;
        }
        
        .option-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            text-align: left;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .option-btn:hover:not(.selected):not(.correct):not(.incorrect) {
            background: rgba(255, 215, 0, 0.15);
            border-color: #FFD700;
            transform: translateX(5px);
        }
        
        .option-btn.selected {
            background: rgba(255, 215, 0, 0.25);
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .option-btn.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
            animation: correctPulse 1s ease;
        }
        
        .option-btn.incorrect {
            background: rgba(244, 67, 54, 0.3);
            border-color: #F44336;
            animation: shake 0.5s ease;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        .quiz-btn {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #FFD700;
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
        }
        
        .quiz-btn:hover:not(:disabled) {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .quiz-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .quiz-btn.submit-btn {
            background: linear-gradient(90deg, #FF416C, #FF4B2B);
            border: none;
        }
        
        /* ç»“æœé¡µé¢æ ·å¼ */
        .result-content {
            text-align: center;
            padding: 20px 0;
        }
        
        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }
        
        .result-message {
            font-size: 24px;
            margin-bottom: 30px;
            color: #FFD700;
        }
        
        .result-details {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .score-display {
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            margin: 10px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .reward-text {
            font-size: 20px;
            color: #4CAF50;
            margin-top: 25px;
            padding: 15px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 12px;
            border: 1px solid #4CAF50;
        }
        
        /* æ—‹è½¬åŠ¨ç”» */
        @keyframes rotateIndicator {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .spinning {
            animation: rotateIndicator 1s linear infinite;
        }
        
        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 480px) {
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            
            .question-text {
                font-size: 16px;
            }
            
            .option-btn {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .quiz-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ° å¹¸è¿å¤§æŠ½å¥– ğŸ°</h1>
            <p class="subtitle">ç‚¹å‡»ä¸­å¤®æŒ‰é’®å¼€å§‹æŠ½å¥–ï¼Œå¥–å“ç¯ç»•æ—‹è½¬ï¼Œç¥ä½ å¥½è¿ï¼</p>
            
            <div class="music-controls">
                <button class="control-btn" id="bgMusicBtn">
                    <span>ğŸµ</span> èƒŒæ™¯éŸ³ä¹: <span id="bgMusicStatus">å¼€å¯</span>
                </button>
                <button class="control-btn" id="soundEffectBtn">
                    <span>ğŸ”Š</span> æ—‹è½¬éŸ³æ•ˆ: <span id="soundEffectStatus">å¼€å¯</span>
                </button>
            </div>
        </div>
        
        <!-- ä¸»æŠ½å¥–åŒºåŸŸ -->
        <div class="lottery-area">
            <div class="prize-circle" id="prizeCircle"></div>
            
            <div class="center-button">
                <button class="lottery-btn" id="startLotteryBtn">
                    <div style="font-size: 32px;">ğŸ</div>
                    <div>å¼€å§‹æŠ½å¥–</div>
                    <div style="font-size: 14px;">å‰©ä½™: <span id="chanceCount">3</span> æ¬¡</div>
                </button>
            </div>
        </div>
        
        <!-- ç»“æœå±•ç¤º -->
        <div class="result-display">
            <div class="result-text" id="resultText">ç­‰å¾…æŠ½å¥–å¼€å§‹...</div>
            <div class="result-prize" id="resultPrize" style="display: none;">
                <img id="resultImage" class="result-image" alt="ä¸­å¥–å¥–å“">
                <div>
                    <div style="color: #FFD700; font-size: 18px;" id="resultPrizeName"></div>
                    <div style="margin-top: 8px; font-size: 14px;" id="resultTime"></div>
                </div>
            </div>
        </div>
        
        <!-- ä¸­å¥–åå• -->
        <div class="winner-board">
            <div class="board-header">
                <div class="board-title">ğŸ† å®æ—¶ä¸­å¥–åå•</div>
                <div class="button-group">
                    <button class="view-history-btn" id="viewHistoryBtn">ğŸ“œ æˆ‘çš„ä¸­å¥–è®°å½•</button>
                    <button class="reset-btn" id="resetBtn">ğŸ”„ é‡ç½®æ¬¡æ•°</button>
                </div>
            </div>
            
            <div class="winner-scroll">
                <ul class="winner-list" id="winnerList"></ul>
            </div>
        </div>
    </div>
    
    <!-- æˆ‘çš„ä¸­å¥–è®°å½•å¼¹çª— -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">Ã—</button>
            <h2 style="color: #FFD700; margin-bottom: 15px;">ğŸ“‹ æˆ‘çš„ä¸­å¥–è®°å½•</h2>
            <div id="historyContent" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>
    
    <!-- ç­”é¢˜å¼¹çª— -->
    <div class="modal" id="quizModal">
        <div class="modal-content">
            <div id="quizContent">
                <!-- ç­”é¢˜å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- éŸ³ä¹å…ƒç´  - ä¿®å¤è·¯å¾„ -->
    <audio id="backgroundMusic" loop>
        <source src="papa.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ 
    </audio>
    
    <audio id="dingSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3" type="audio/mpeg">
    </audio>

    <script>
        // å¥–å“æ•°æ®
        const prizes = [
            { id: 1, name: "iPhone 16 Pro", image: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=300&h=300&fit=crop", probability: 5 },
            { id: 2, name: "iPad Air", image: "https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=300&h=300&fit=crop", probability: 8 },
            { id: 3, name: "AirPods Pro", image: "https://images.unsplash.com/photo-1572569511254-d8f925fe2cbb?w=300&h=300&fit=crop", probability: 12 },
            { id: 4, name: "Switch OLED", image: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=300&h=300&fit=crop", probability: 15 },
            { id: 5, name: "æ™ºèƒ½æ‰‹è¡¨", image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=300&h=300&fit=crop", probability: 20 },
            { id: 6, name: "ç›¸æœº", image: "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=300&h=300&fit=crop", probability: 40 }
        ];

        // ç½‘ååº“ï¼ˆ80ä¸ªæµè¡Œç½‘åï¼‰
        const nicknames = [
            "æ˜Ÿæ²³æ»šçƒ«", "äººé—´ç†æƒ³", "æœˆè‰²çœŸç¾", "æ¸…é£å¾æ¥", "äº‘å·äº‘èˆ’", "èŠ±å¼€å¯Œè´µ", "æ˜Ÿè¾°å¤§æµ·",
            "æ—¶å…‰é™å¥½", "æ˜¥æš–èŠ±å¼€", "ç§‹æ°´ä¼Šäºº", "åŒ—åŸä»¥åŒ—", "å—é£æœªèµ·", "è¥¿æ¥¼æœˆä¸‹", "ä¸œç¯±æŠŠé…’",
            "å‰‘æŒ‡è‹ç©¹", "ç¬‘å‚²æ±Ÿæ¹–", "å¢¨æŸ“å€¾åŸ", "æµ…ç¬‘å®‰ç„¶", "ç¹åè½å¹•", "ç´ å¹´é”¦æ—¶", "æµ®ç”Ÿè‹¥æ¢¦",
            "åŠåŸçƒŸæ²™", "ä¸€ä¸–ç¹å", "ä¸‰ç”Ÿä¸‰ä¸–", "å››æµ·å…«è’", "äº”æ¹–å››æµ·", "å…­é“è½®å›", "ä¸ƒæ˜Ÿé«˜ç…§",
            "å…«ä»™è¿‡æµ·", "ä¹ä¹å½’ä¸€", "åå…¨åç¾", "ç™¾äº‹å¯ä¹", "åƒä¸åƒå¯»", "ä¸‡é‡ŒæŒ‘ä¸€", "äº¿è¡¨äººæ‰",
            "ç‹è€…å½’æ¥", "è£è€€ç‹è€…", "åƒé¸¡å¤§ç¥", "ç”µç«å°‘å¥³", "æ¸¸æˆäººç”Ÿ", "äºŒæ¬¡å…ƒå›", "åŠ¨æ¼«å®…ç”·",
            "æ–‡è‰ºé’å¹´", "æ‘‡æ»šå·¨æ˜Ÿ", "æµè¡Œæ•™ä¸»", "æ—¶å°šè¾¾äºº", "ç¾é£Ÿå®¶", "æ—…è¡Œå®¶", "æ‘„å½±å¸ˆ",
            "ç¨‹åºå‘˜", "è®¾è®¡å¸ˆ", "äº§å“ç»ç†", "è¿è¥å¤§ä½¬", "å¸‚åœºä¸“å®¶", "é”€å”®å† å†›", "è´¢åŠ¡è‡ªç”±",
            "æŠ•èµ„å¤©æ‰", "åˆ›ä¸šå…ˆé”‹", "å­¦éœ¸å›", "å­¦æ¸£é€†è¢­", "è€ƒè¯•å¤§ç¥", "è®ºæ–‡æ€æ‰‹", "å®ä¹ è¾¾äºº",
            "èŒåœºç²¾è‹±", "é€€ä¼‘ç”Ÿæ´»", "å…»ç”Ÿä¸“å®¶", "å¥èº«è¾¾äºº", "ç‘œä¼½å¤§å¸ˆ", "è·‘æ­¥å† å†›", "æ¸¸æ³³å¥å°†",
            "ç¯®çƒé«˜æ‰‹", "è¶³çƒæ˜æ˜Ÿ", "ç”µç«é€‰æ‰‹", "ä¸»æ’­å¤§ä½¬", "ç½‘çº¢è¾¾äºº", "æµé‡æ˜æ˜Ÿ", "ç²‰ä¸åƒä¸‡",
            "ç‚¹èµè¿‡ä¸‡", "è¯„è®ºç ´åƒ", "è½¬å‘ç™¾ä¸‡", "çƒ­æœç¬¬ä¸€", "çƒ­é—¨è¯é¢˜", "æµé‡æ‹…å½“"
        ];

        // è„‘ç­‹æ€¥è½¬å¼¯é¢˜åº“ï¼ˆ50é“é¢˜ï¼‰
        const quizQuestions = [
            { question: "ä»€ä¹ˆä¸œè¥¿è¶Šæ´—è¶Šè„ï¼Ÿ", options: ["è¡£æœ", "æ°´", "ç¢—", "æ‰‹"], answer: 1 },
            { question: "ä»€ä¹ˆé—¨æ°¸è¿œå…³ä¸ä¸Šï¼Ÿ", options: ["çƒé—¨", "å†°ç®±é—¨", "å¿ƒé—¨", "è½¦é—¨"], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿å¤©æ°”è¶Šçƒ­ï¼Œå®ƒçˆ¬å¾—è¶Šé«˜ï¼Ÿ", options: ["æ¸©åº¦è®¡", "èš‚èš", "å¤ªé˜³", "æ°”çƒ"], answer: 0 },
            { question: "ä»€ä¹ˆè›‹æ‰“ä¸çƒ‚ï¼Œç…®ä¸ç†Ÿï¼Œæ›´ä¸èƒ½åƒï¼Ÿ", options: ["é¸¡è›‹", "ç¬¨è›‹", "é¸­è›‹", "é›¶è›‹"], answer: 1 },
            { question: "ç”¨æ¤°å­å’Œè¥¿ç“œæ‰“å¤´å“ªä¸€ä¸ªæ¯”è¾ƒç—›ï¼Ÿ", options: ["æ¤°å­", "è¥¿ç“œ", "å¤´", "æ‰‹"], answer: 2 },
            { question: "æ—©æ™¨é†’æ¥ï¼Œæ¯ä¸ªäººéƒ½ä¼šå»åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä»€ä¹ˆï¼Ÿ", options: ["ççœ¼", "åˆ·ç‰™", "ä¸Šå•æ‰€", "ç©¿è¡£æœ"], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿äººä»¬åœ¨ä¸åœåœ°åƒå®ƒï¼Œå´æ°¸è¿œåƒä¸é¥±ï¼Ÿ", options: ["ç©ºæ°”", "ç±³é¥­", "é›¶é£Ÿ", "å£æ°´"], answer: 0 },
            { question: "ä»€ä¹ˆè½¦å­å¯¸æ­¥éš¾è¡Œï¼Ÿ", options: ["é£è½¦", "è‡ªè¡Œè½¦", "æ±½è½¦", "é©¬è½¦"], answer: 0 },
            { question: "å“ªä¸€ä¸ªæœˆæœ‰äºŒåå…«å¤©ï¼Ÿ", options: ["äºŒæœˆ", "æ¯ä¸ªæœˆ", "åäºŒæœˆ", "å…­æœˆ"], answer: 1 },
            { question: "ä»€ä¹ˆè‹±æ–‡å­—æ¯æœ€å¤šäººå–œæ¬¢å¬ï¼Ÿ", options: ["A", "C", "D", "CD"], answer: 3 },
            { question: "ä¸€åªå‡¶çŒ›çš„é¥¿çŒ«ï¼Œçœ‹åˆ°è€é¼ ï¼Œä¸ºä½•æ‹”è…¿å°±è·‘ï¼Ÿ", options: ["å»è¿½è€é¼ ", "å»æ‰è€é¼ ", "è·‘å»æ‹ç”µå½±", "è·‘å»æŠ“é±¼"], answer: 3 },
            { question: "å°çº¢ä¸å¦ˆå¦ˆéƒ½åœ¨åŒä¸€ä¸ªç­é‡Œä¸Šè¯¾ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ", options: ["å¦ˆå¦ˆæ˜¯è€å¸ˆ", "å°çº¢æ˜¯è€å¸ˆ", "å¦ˆå¦ˆæ˜¯å­¦ç”Ÿ", "å¦ˆå¦ˆåœ¨å¬è¯¾"], answer: 0 },
            { question: "ä»€ä¹ˆæ°´æ°¸è¿œç”¨ä¸å®Œï¼Ÿ", options: ["è‡ªæ¥æ°´", "æ³ªæ°´", "å£æ°´", "æ³ªæ°´"], answer: 2 },
            { question: "ä»€ä¹ˆä¸œè¥¿æœ‰äº”ä¸ªå¤´ï¼Œä½†äººä¸è§‰å¾—å®ƒæ€ªï¼Ÿ", options: ["æ‰‹", "è„š", "æ‰‹å¥—", "æ€ªç‰©"], answer: 1 },
            { question: "ä»€ä¹ˆé…’ä¸èƒ½å–ï¼Ÿ", options: ["ç™½é…’", "å•¤é…’", "ç¢˜é…’", "çº¢é…’"], answer: 2 },
            { question: "ä»€ä¹ˆä¸œè¥¿æ™šä¸Šæ‰ç”Ÿå‡ºå°¾å·´å‘¢ï¼Ÿ", options: ["æ˜Ÿæ˜Ÿ", "æœˆäº®", "æµæ˜Ÿ", "è¤ç«è™«"], answer: 2 },
            { question: "ä¹¦åº—é‡Œä¹°ä¸åˆ°ä»€ä¹ˆä¹¦ï¼Ÿ", options: ["æ•™ç§‘ä¹¦", "å°è¯´", "é—ä¹¦", "æ¼«ç”»"], answer: 2 },
            { question: "ä»€ä¹ˆè·¯æœ€çª„ï¼Ÿ", options: ["å±±è·¯", "æ°´è·¯", "å†¤å®¶è·¯çª„", "å…¬è·¯"], answer: 2 },
            { question: "ä»€ä¹ˆäººå§‹ç»ˆä¸æ•¢æ´—æ¾¡ï¼Ÿ", options: ["æ³¥äºº", "ç›²äºº", "è€äºº", "å°å­©"], answer: 0 },
            { question: "ä»€ä¹ˆç‰›ä¸ä¼šåƒè‰ï¼Ÿ", options: ["èœ—ç‰›", "å¥¶ç‰›", "é»„ç‰›", "æ°´ç‰›"], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿å˜´é‡Œæ²¡æœ‰èˆŒå¤´ï¼Ÿ", options: ["èŒ¶å£¶å˜´", "æ°´å£¶", "èŒ¶æ¯", "ä¿æ¸©æ¯"], answer: 0 },
            { question: "ä»€ä¹ˆäººç”Ÿç—…ä»æ¥ä¸çœ‹åŒ»ç”Ÿï¼Ÿ", options: ["ç›²äºº", "åŒ»ç”Ÿ", "æœºå™¨äºº", "æ­»äºº"], answer: 1 },
            { question: "æ—¶é’Ÿä»€ä¹ˆæ—¶å€™ä¸ä¼šèµ°ï¼Ÿ", options: ["æ²¡ç”µæ—¶", "åäº†æ—¶", "æ—¶é’Ÿæœ¬æ¥å°±ä¸ä¼šèµ°", "è£…çš„æ—¶å€™"], answer: 2 },
            { question: "ä»€ä¹ˆå­—å…¨ä¸–ç•Œé€šç”¨ï¼Ÿ", options: ["è‹±æ–‡", "ä¸­æ–‡", "é˜¿æ‹‰ä¼¯æ•°å­—", "æ•°å­¦ç¬¦å·"], answer: 2 },
            { question: "ä¸ºä»€ä¹ˆå°ç‹ä»åˆä¸€åˆ°åˆä¸‰å°±å­¦äº†ä¸€ç¯‡è¯¾æ–‡ï¼Ÿ", options: ["ä»–å¾ˆæ‡’", "è€å¸ˆåªæ•™ä¸€ç¯‡", "è¯¾æ–‡å¾ˆé•¿", "åˆä¸€åˆ°åˆä¸‰åªæœ‰ä¸‰å¤©"], answer: 3 },
            { question: "ä¸€ä¸ªäººç©ºè‚šå­æœ€å¤šèƒ½åƒå‡ ä¸ªé¸¡è›‹ï¼Ÿ", options: ["ä¸€ä¸ª", "ä¸¤ä¸ª", "ä¸‰ä¸ª", "ä¸€ä¸ªï¼ˆå› ä¸ºåƒäº†ä¸€ä¸ªåå°±ä¸æ˜¯ç©ºè‚šå­äº†ï¼‰"], answer: 3 },
            { question: "å½“å“¥ä¼¦å¸ƒä¸€åªè„šè¿ˆä¸Šæ–°å¤§é™†åï¼Œç´§æ¥ç€åšä»€ä¹ˆï¼Ÿ", options: ["è¿ˆä¸Šå¦ä¸€åªè„š", "æ’ä¸Šæ——å¸œ", "é«˜å‘¼èƒœåˆ©", "å¼€å§‹æ¢é™©"], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿æ¯”ä¹Œé¸¦æ›´è®¨åŒï¼Ÿ", options: ["ä¹Œé¸¦å˜´", "ä¹Œé¸¦çš„åŒç±»", "ä¹Œé¸¦çš„æ•Œäºº", "ä¹Œé¸¦æœ¬èº«"], answer: 0 },
            { question: "ä¸–ç•Œä¸Šé™¤äº†ç«è½¦å•¥è½¦æœ€é•¿ï¼Ÿ", options: ["å µè½¦", "ç«è½¦", "æ±½è½¦", "è´§è½¦"], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿ä¸èƒ½åƒï¼Ÿ", options: ["ä¸œè¥¿æ–¹å‘", "é£Ÿç‰©", "æ°´", "ç©ºæ°”"], answer: 0 },
            { question: "ä¸ºä»€ä¹ˆå¤§é›ç§‹å¤©è¦é£åˆ°å—æ–¹å»ï¼Ÿ", options: ["å› ä¸ºå—æ–¹æš–å’Œ", "å› ä¸ºèµ°å¾—å¤ªæ…¢äº†", "å› ä¸ºé£æ¯”èµ°å¿«", "å› ä¸ºæ˜¯å€™é¸Ÿ"], answer: 1 },
            { question: "ä»€ä¹ˆå¸½ä¸èƒ½æˆ´ï¼Ÿ", options: ["èºä¸å¸½", "è‰å¸½", "æ£’çƒå¸½", "ç¤¼å¸½"], answer: 0 },
            { question: "ä¸ºä»€ä¹ˆå¤§éƒ¨åˆ†ä½›æ•™å¾’éƒ½åœ¨åŒ—åŠçƒï¼Ÿ", options: ["å—æ— é˜¿å¼¥é™€ä½›", "æ°”å€™åŸå› ", "å†å²åŸå› ", "åœ°ç†åŸå› "], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿æœ‰å¤´æ— è„šï¼Ÿ", options: ["é’‰å­", "è›‡", "èš¯èš“", "é“…ç¬”"], answer: 0 },
            { question: "é»‘äººä¸ºä»€ä¹ˆå–œæ¬¢åƒç™½è‰²å·§å…‹åŠ›ï¼Ÿ", options: ["æ€•å’¬åˆ°è‡ªå·±çš„æ‰‹", "ç™½è‰²å¥½åƒ", "é»‘è‰²å¤ªè‹¦", "è¥å…»å¥½"], answer: 0 },
            { question: "è°å¤©å¤©å»çœ‹ç—…ï¼Ÿ", options: ["åŒ»ç”Ÿ", "ç—…äºº", "æŠ¤å£«", "åŒ»é™¢é™¢é•¿"], answer: 0 },
            { question: "ä»€ä¹ˆç…§ç‰‡çœ‹ä¸å‡ºç…§çš„æ˜¯è°ï¼Ÿ", options: ["Xå…‰ç…§ç‰‡", "æ¨¡ç³Šç…§ç‰‡", "èƒŒå½±ç…§ç‰‡", "é»‘ç™½ç…§ç‰‡"], answer: 0 },
            { question: "ä»€ä¹ˆå¸ƒå‰ªä¸æ–­ï¼Ÿ", options: ["ç€‘å¸ƒ", "æ£‰å¸ƒ", "éº»å¸ƒ", "çº±å¸ƒ"], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿åšçš„äººçŸ¥é“ï¼Œä¹°çš„äººçŸ¥é“ï¼Œå–çš„äººçŸ¥é“ï¼Œç”¨çš„äººå´ä¸çŸ¥é“ï¼Ÿ", options: ["æ£ºæ", "è¡£æœ", "é£Ÿç‰©", "æˆ¿å­"], answer: 0 },
            { question: "ä¸€ä¸ªäººä»é£æœºä¸Šæ‰ä¸‹æ¥ï¼Œä¸ºä»€ä¹ˆæ²¡æ‘”æ­»å‘¢ï¼Ÿ", options: ["é£æœºåœåœ¨åœ°ä¸Š", "æœ‰é™è½ä¼", "æ‰åœ¨æµ·é‡Œ", "æ‰åœ¨æ£‰èŠ±ä¸Š"], answer: 0 },
            { question: "ä»€ä¹ˆäººå¿ƒè‚ æœ€ä¸å¥½ï¼Ÿ", options: ["å¾—èƒƒè‚ ç‚çš„äºº", "å¿ƒè„ç—…çš„äºº", "æ²¡è‰¯å¿ƒçš„äºº", "åŒ»ç”Ÿ"], answer: 1 },
            { question: "å“ªé¡¹æ¯”èµ›æ˜¯å¾€åè·‘çš„ï¼Ÿ", options: ["æ‹”æ²³", "è·‘æ­¥", "æ¸¸æ³³", "è·³è¿œ"], answer: 0 },
            { question: "ä»€ä¹ˆå®˜ä¸ä»…ä¸é¢†å·¥èµ„ï¼Œè¿˜è¦è‡ªæè…°åŒ…ï¼Ÿ", options: ["æ–°éƒå®˜", "å†›å®˜", "æ³•å®˜", "è€ƒå®˜"], answer: 0 },
            { question: "ä»€ä¹ˆäººç”Ÿæ¥å°±ç§°ç‹ï¼Ÿ", options: ["å›½ç‹", "ç‹å­", "çš‡å¸", "å§“ç‹çš„äºº"], answer: 3 },
            { question: "ä»€ä¹ˆèŠ±æ²¡æœ‰æ ¹ï¼Ÿ", options: ["çƒŸèŠ±", "é›ªèŠ±", "æµªèŠ±", "ç«èŠ±"], answer: 0 },
            { question: "ä»€ä¹ˆä¸œè¥¿æœ€å®¹æ˜“æ»¡è¶³ï¼Ÿ", options: ["è¢œå­", "é‹å­", "å¸½å­", "æ‰‹å¥—"], answer: 0 },
            { question: "ä»€ä¹ˆé¸¡æ²¡æœ‰ç¿…è†€ï¼Ÿ", options: ["ç”°é¸¡", "å±±é¸¡", "é‡é¸¡", "çƒ§é¸¡"], answer: 0 },
            { question: "ä»€ä¹ˆèˆ¹ä»æ¥ä¸ä¸‹æ°´ï¼Ÿ", options: ["å®‡å®™é£èˆ¹", "èˆªç©ºæ¯èˆ°", "å¸†èˆ¹", "ç ´èˆ¹"], answer: 0 },
            { question: "ä»€ä¹ˆäººä¸€å¹´ä¸­åªå·¥ä½œä¸€å¤©ï¼Ÿ", options: ["åœ£è¯è€äºº", "æ¼”å‘˜", "ç¨‹åºå‘˜", "è€å¸ˆ"], answer: 0 },
            { question: "ä»€ä¹ˆäº‹å¤©ä¸çŸ¥é“åœ°çŸ¥é“ï¼Œä½ ä¸çŸ¥é“æˆ‘çŸ¥é“ï¼Ÿ", options: ["é‹å­ç ´äº†", "ç§˜å¯†", "å¤©æ°”", "ç­”æ¡ˆ"], answer: 0 }
        ];

        // çŠ¶æ€å˜é‡
        let isDrawing = false;
        let remainingChances = 3;
        let isBgMusicOn = true;
        let isSoundEffectOn = true;
        let winners = [];
        let myHistory = [];
        let spinInterval = null;
        let currentUser = nicknames[Math.floor(Math.random() * nicknames.length)];
        
        // ç­”é¢˜çŠ¶æ€
        let quizState = {
            currentQuestion: 0,
            score: 0,
            selectedOption: null,
            quizCompleted: false,
            questions: []
        };

        // DOMå…ƒç´ 
        const elements = {
            prizeCircle: document.getElementById('prizeCircle'),
            startLotteryBtn: document.getElementById('startLotteryBtn'),
            chanceCount: document.getElementById('chanceCount'),
            resultText: document.getElementById('resultText'),
            resultPrize: document.getElementById('resultPrize'),
            resultImage: document.getElementById('resultImage'),
            resultPrizeName: document.getElementById('resultPrizeName'),
            resultTime: document.getElementById('resultTime'),
            winnerList: document.getElementById('winnerList'),
            bgMusicBtn: document.getElementById('bgMusicBtn'),
            soundEffectBtn: document.getElementById('soundEffectBtn'),
            bgMusicStatus: document.getElementById('bgMusicStatus'),
            soundEffectStatus: document.getElementById('soundEffectStatus'),
            viewHistoryBtn: document.getElementById('viewHistoryBtn'),
            resetBtn: document.getElementById('resetBtn'),
            historyModal: document.getElementById('historyModal'),
            quizModal: document.getElementById('quizModal'),
            closeModal: document.getElementById('closeModal'),
            historyContent: document.getElementById('historyContent'),
            quizContent: document.getElementById('quizContent'),
            bgMusic: document.getElementById('backgroundMusic'),
            dingSound: document.getElementById('dingSound')
        };

        // åˆå§‹åŒ–å¥–å“ç¯ç»•å¸ƒå±€
        function initializePrizes() {
            elements.prizeCircle.innerHTML = '';
            const prizeCount = prizes.length;
            const radius = 40;
            
            prizes.forEach((prize, index) => {
                const angle = (360 / prizeCount) * index;
                const radians = (angle * Math.PI) / 180;
                const x = 50 + radius * Math.cos(radians);
                const y = 50 + radius * Math.sin(radians);
                
                const prizeItem = document.createElement('div');
                prizeItem.className = 'prize-item';
                prizeItem.dataset.id = prize.id;
                prizeItem.dataset.index = index;
                
                prizeItem.style.position = 'absolute';
                prizeItem.style.left = `${x}%`;
                prizeItem.style.top = `${y}%`;
                
                prizeItem.innerHTML = `
                    <div class="prize-item-inner">
                        <img src="${prize.image}" alt="${prize.name}">
                        <div class="prize-name">${prize.name}</div>
                    </div>
                `;
                
                elements.prizeCircle.appendChild(prizeItem);
            });
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playDingSound() {
            if (!isSoundEffectOn) return;
            
            try {
                elements.dingSound.currentTime = 0;
                elements.dingSound.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥"));
            } catch (e) {
                console.log("éŸ³æ•ˆé”™è¯¯:", e);
            }
        }

        // å¼€å§‹æŠ½å¥–ï¼ˆç²¾å‡†åœæ­¢ï¼‰
        function startLottery() {
            if (isDrawing) return;
            if (remainingChances <= 0) {
                elements.resultText.textContent = "æŠ½å¥–æ¬¡æ•°å·²ç”¨å®Œï¼ç‚¹å‡»é‡ç½®æ¬¡æ•°è·å–æ›´å¤šæœºä¼š";
                return;
            }
            
            isDrawing = true;
            elements.startLotteryBtn.disabled = true;
            elements.startLotteryBtn.innerHTML = `
                <div style="font-size: 32px;" class="spinning">ğŸ¯</div>
                <div>æŠ½å¥–ä¸­...</div>
            `;
            
            // ç¡®å®šç›®æ ‡å¥–å“
            const totalProbability = prizes.reduce((sum, prize) => sum + prize.probability, 0);
            let randomNum = Math.random() * totalProbability;
            let selectedPrize = prizes[0];
            let targetIndex = 0;
            
            for (let i = 0; i < prizes.length; i++) {
                if (randomNum < prizes[i].probability) {
                    selectedPrize = prizes[i];
                    targetIndex = i;
                    break;
                }
                randomNum -= prizes[i].probability;
            }
            
            console.log(`ç›®æ ‡å¥–å“: ${selectedPrize.name}, ç´¢å¼•: ${targetIndex}`);
            
            // æ¸…é™¤é«˜äº®
            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ—‹è½¬åŠ¨ç”»ï¼šå…ˆå¿«åæ…¢ï¼Œç²¾å‡†åœæ­¢
            let currentIndex = 0;
            let spinCount = 0;
            const totalSpins = 20; // æ€»æ—‹è½¬æ¬¡æ•°ï¼ˆç¡®ä¿è½¬å¤Ÿåœˆæ•°ï¼‰
            const baseSpeed = 80;
            
            function spin() {
                playDingSound();
                
                // æ¸…é™¤ä¸Šä¸€ä¸ªé«˜äº®
                const prevIndex = (currentIndex - 1 + prizes.length) % prizes.length;
                const prevPrize = document.querySelector(`[data-index="${prevIndex}"]`);
                if (prevPrize) prevPrize.classList.remove('active');
                
                // é«˜äº®å½“å‰
                const currentPrize = document.querySelector(`[data-index="${currentIndex}"]`);
                if (currentPrize) {
                    currentPrize.classList.add('active');
                }
                
                currentIndex = (currentIndex + 1) % prizes.length;
                spinCount++;
                
                // åŠ¨æ€é€Ÿåº¦æ§åˆ¶ï¼šå…ˆå¿«åæ…¢
                let currentSpeed;
                if (spinCount < totalSpins * 0.6) {
                    // å‰60%ï¼šå¿«é€Ÿæ—‹è½¬
                    currentSpeed = baseSpeed;
                } else if (spinCount < totalSpins * 0.8) {
                    // ä¸­é—´20%ï¼šé€æ¸å‡é€Ÿ
                    currentSpeed = baseSpeed + (spinCount - totalSpins * 0.6) * 10;
                } else {
                    // æœ€å20%ï¼šæ›´æ…¢é€Ÿåº¦ï¼Œå‡†å¤‡åœæ­¢
                    currentSpeed = baseSpeed + 100 + (spinCount - totalSpins * 0.8) * 30;
                }
                
                if (spinCount < totalSpins) {
                    spinInterval = setTimeout(spin, currentSpeed);
                } else {
                    clearTimeout(spinInterval);
                    
                    // è®¡ç®—éœ€è¦ç§»åŠ¨çš„æ¬¡æ•°åˆ°ç›®æ ‡ä½ç½®
                    let movesToTarget = (targetIndex - currentIndex + prizes.length) % prizes.length;
                    if (movesToTarget === 0) movesToTarget = prizes.length; // ç¡®ä¿è‡³å°‘ç§»åŠ¨ä¸€æ¬¡
                    
                    console.log(`éœ€è¦ç§»åŠ¨ ${movesToTarget} æ¬¡åˆ°è¾¾ç›®æ ‡`);
                    
                    let finalMoves = 0;
                    
                    function finalAdjustment() {
                        playDingSound();
                        
                        // æ¸…é™¤ä¸Šä¸€ä¸ª
                        const prev = document.querySelector(`[data-index="${currentIndex}"]`);
                        if (prev) prev.classList.remove('active');
                        
                        // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª
                        currentIndex = (currentIndex + 1) % prizes.length;
                        const current = document.querySelector(`[data-index="${currentIndex}"]`);
                        if (current) {
                            current.classList.add('active');
                        }
                        
                        finalMoves++;
                        
                        if (finalMoves < movesToTarget) {
                            setTimeout(finalAdjustment, 200 + finalMoves * 80); // è¶Šæ¥è¶Šæ…¢
                        } else {
                            // æœ€ç»ˆåœåœ¨ç›®æ ‡ä½ç½®
                            setTimeout(() => {
                                finalizeResult(selectedPrize, targetIndex);
                            }, 500);
                        }
                    }
                    
                    setTimeout(finalAdjustment, 300);
                }
            }
            
            spin();
        }

        // æœ€ç»ˆç¡®å®šç»“æœ
        function finalizeResult(selectedPrize, targetIndex) {
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            document.querySelectorAll('.prize-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // é«˜äº®æœ€ç»ˆå¥–å“
            const winningItem = document.querySelector(`[data-index="${targetIndex}"]`);
            if (winningItem) {
                winningItem.classList.add('active');
            }
            
            // æ˜¾ç¤ºç»“æœ
            const now = new Date();
            const fullTime = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
            const shortTime = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
            
            elements.resultText.textContent = `ğŸ‰ æ­å–œï¼æŠ½ä¸­ ${selectedPrize.name} ğŸ‰`;
            elements.resultImage.src = selectedPrize.image;
            elements.resultPrizeName.textContent = selectedPrize.name;
            elements.resultTime.textContent = `ä¸­å¥–æ—¶é—´: ${fullTime}`;
            elements.resultPrize.style.display = 'flex';
            
            // æ›´æ–°æŠ½å¥–æ¬¡æ•°
            remainingChances--;
            elements.chanceCount.textContent = remainingChances;
            
            // æ·»åŠ åˆ°æˆ‘çš„ä¸­å¥–è®°å½•
            myHistory.unshift({
                name: currentUser,
                prize: selectedPrize.name,
                time: fullTime,
                image: selectedPrize.image
            });
            
            // ç”Ÿæˆéšæœºç½‘åæ·»åŠ åˆ°å…¬å…±ä¸­å¥–åå•
            const randomNickname = nicknames[Math.floor(Math.random() * nicknames.length)];
            addToWinners(randomNickname, selectedPrize.name, shortTime);
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            isDrawing = false;
            elements.startLotteryBtn.disabled = false;
            elements.startLotteryBtn.innerHTML = `
                <div style="font-size: 32px;">ğŸ</div>
                <div>å¼€å§‹æŠ½å¥–</div>
                <div style="font-size: 14px;">å‰©ä½™: ${remainingChances} æ¬¡</div>
            `;
            elements.startLotteryBtn.classList.remove('spinning');
            
            // æ›´æ–°æ˜¾ç¤º
            updateHistoryDisplay();
        }

        // æ·»åŠ åˆ°ä¸­å¥–åå•
        function addToWinners(name, prize, time) {
            winners.unshift({ name, prize, time });
            if (winners.length > 50) winners = winners.slice(0, 50);
            updateWinnerList();
        }

        // æ›´æ–°ä¸­å¥–åå•æ˜¾ç¤ºï¼ˆéšæœºé¡ºåºæ’­æ”¾ï¼‰
        function updateWinnerList() {
            elements.winnerList.innerHTML = '';
            
            // æ‰“ä¹±é¡ºåºåˆ›å»ºéšæœºæ’­æ”¾æ•ˆæœ
            const shuffledWinners = [...winners].sort(() => Math.random() - 0.5);
            
            // å–å‰10ä¸ªæ˜¾ç¤º
            shuffledWinners.slice(0, 10).forEach(winner => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>ğŸ‘¤ ${winner.name}</span>
                    <span style="color: #FFD700; margin: 0 10px;">${winner.prize}</span>
                    <span style="font-size: 12px; opacity: 0.8;">${winner.time}</span>
                `;
                elements.winnerList.appendChild(li);
            });
            
            // æ¯5ç§’é‡æ–°éšæœºæ’åº
            setTimeout(updateWinnerList, 5000);
        }

        // æ›´æ–°æˆ‘çš„ä¸­å¥–è®°å½•æ˜¾ç¤º
        function updateHistoryDisplay() {
            elements.historyContent.innerHTML = '';
            
            if (myHistory.length === 0) {
                elements.historyContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">æš‚æ— ä¸­å¥–è®°å½•ï¼Œå¿«å»æŠ½å¥–å§ï¼</p>';
                return;
            }
            
            myHistory.forEach(record => {
                const recordDiv = document.createElement('div');
                recordDiv.style.cssText = 'display: flex; align-items: center; padding: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; border-left: 4px solid #FFD700;';
                
                recordDiv.innerHTML = `
                    <img src="${record.image}" style="width: 50px; height: 50px; border-radius: 8px; margin-right: 15px; border: 2px solid #FFD700;">
                    <div style="flex: 1;">
                        <div style="color: #FFD700; font-weight: bold;">${record.name}</div>
                        <div style="margin-top: 5px;">${record.prize}</div>
                    </div>
                    <div style="font-size: 12px; opacity: 0.8;">${record.time}</div>
                `;
                
                elements.historyContent.appendChild(recordDiv);
            });
        }

        // åˆ‡æ¢èƒŒæ™¯éŸ³ä¹
        function toggleBgMusic() {
            isBgMusicOn = !isBgMusicOn;
            elements.bgMusicStatus.textContent = isBgMusicOn ? 'å¼€å¯' : 'å…³é—­';
            
            if (isBgMusicOn) {
                elements.bgMusic.play().catch(e => console.log("éŸ³ä¹æ’­æ”¾å¤±è´¥"));
                elements.bgMusicBtn.classList.add('active');
            } else {
                elements.bgMusic.pause();
                elements.bgMusicBtn.classList.remove('active');
            }
        }

        // åˆ‡æ¢éŸ³æ•ˆ
        function toggleSoundEffect() {
            isSoundEffectOn = !isSoundEffectOn;
            elements.soundEffectStatus.textContent = isSoundEffectOn ? 'å¼€å¯' : 'å…³é—­';
            elements.soundEffectBtn.classList.toggle('active', isSoundEffectOn);
        }

        // å¼€å§‹ç­”é¢˜é‡ç½®æµç¨‹
        function startQuiz() {
            // é‡ç½®ç­”é¢˜çŠ¶æ€
            quizState = {
                currentQuestion: 0,
                score: 0,
                selectedOption: null,
                quizCompleted: false,
                questions: []
            };
            
            // ä»é¢˜åº“ä¸­éšæœºé€‰æ‹©5é“é¢˜
            const shuffledQuestions = [...quizQuestions].sort(() => Math.random() - 0.5);
            quizState.questions = shuffledQuestions.slice(0, 5);
            
            // æ˜¾ç¤ºç­”é¢˜å¼¹çª—
            showQuizQuestion();
            elements.quizModal.style.display = 'flex';
        }

        // æ˜¾ç¤ºå½“å‰é¢˜ç›®
        function showQuizQuestion() {
            const currentQ = quizState.questions[quizState.currentQuestion];
            const progress = ((quizState.currentQuestion) / 5) * 100;
            
            elements.quizContent.innerHTML = `
                <div class="quiz-container">
                    <div class="quiz-title">
                        <span>ğŸ§ </span> è„‘ç­‹æ€¥è½¬å¼¯æŒ‘æˆ˜
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                    
                    <div class="quiz-info">
                        <div>é¢˜ç›®: ${quizState.currentQuestion + 1}/5</div>
                        <div>å¾—åˆ†: ${quizState.score}/3</div>
                    </div>
                    
                    <div class="question-box">
                        <div class="question-text">${currentQ.question}</div>
                        <div class="options-container">
                            ${currentQ.options.map((option, index) => `
                                <button class="option-btn ${quizState.selectedOption === index ? 'selected' : ''}" 
                                        onclick="selectOption(${index})">
                                    ${String.fromCharCode(65 + index)}. ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="quiz-controls">
                        <button class="quiz-btn submit-btn" onclick="submitAnswer()" ${quizState.selectedOption === null ? 'disabled' : ''}>
                            ${quizState.currentQuestion < 4 ? 'æäº¤ç­”æ¡ˆ' : 'æäº¤æœ€åä¸€é¢˜'}
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; font-size: 14px; color: #999;">
                        ğŸ’¡ æç¤ºï¼šç­”å¯¹3é¢˜å³å¯é‡ç½®æŠ½å¥–æ¬¡æ•°
                    </div>
                </div>
            `;
        }

        // æ˜¾ç¤ºç­”é¢˜ç»“æœ
        function showQuizResult() {
            const success = quizState.score >= 3;
            const progress = 100;
            
            elements.quizContent.innerHTML = `
                <div class="result-content">
                    <div class="result-icon">${success ? 'ğŸ‰' : 'ğŸ˜¢'}</div>
                    <div class="result-message">
                        ${success ? 'æ­å–œä½ ï¼æŒ‘æˆ˜æˆåŠŸï¼' : 'å¾ˆé—æ†¾ï¼ŒæŒ‘æˆ˜å¤±è´¥ï¼'}
                    </div>
                    
                    <div class="result-details">
                        <div>ç­”é¢˜å®Œæˆ</div>
                        <div class="score-display">${quizState.score}/5 åˆ†</div>
                        <div style="margin-top: 15px; color: #ccc;">
                            ${success ? 
                                'âœ… ä½ å·²æˆåŠŸç­”å¯¹3é¢˜ä»¥ä¸Š' : 
                                'âŒ éœ€è¦ç­”å¯¹3é¢˜æ‰èƒ½é‡ç½®æ¬¡æ•°'
                            }
                        </div>
                    </div>
                    
                    ${success ? `
                        <div class="reward-text">
                            ğŸ è·å¾—å¥–åŠ±ï¼šæŠ½å¥–æ¬¡æ•°é‡ç½®ä¸º3æ¬¡ï¼
                        </div>
                    ` : `
                        <div style="color: #F44336; margin: 20px 0; padding: 15px; background: rgba(244, 67, 54, 0.1); border-radius: 12px; border: 1px solid #F44336;">
                            ğŸ’¡ æç¤ºï¼šå¯ä»¥é‡æ–°æŒ‘æˆ˜è·å–é‡ç½®èµ„æ ¼
                        </div>
                    `}
                    
                    <div class="quiz-controls">
                        <button class="quiz-btn" onclick="${success ? 'resetChances()' : 'closeQuizModal()'}">
                            ${success ? 'é‡ç½®æŠ½å¥–æ¬¡æ•°' : 'å…³é—­'}
                        </button>
                        ${!success ? `
                            <button class="quiz-btn submit-btn" onclick="retryQuiz()">
                                é‡æ–°æŒ‘æˆ˜
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // é€‰æ‹©é€‰é¡¹
        window.selectOption = function(index) {
            quizState.selectedOption = index;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            document.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.classList.remove('selected');
                if (i === index) {
                    btn.classList.add('selected');
                }
            });
            
            // å¯ç”¨æäº¤æŒ‰é’®
            const submitBtn = document.querySelector('.quiz-btn');
            if (submitBtn) submitBtn.disabled = false;
        }

        // æäº¤ç­”æ¡ˆ
        window.submitAnswer = function() {
            if (quizState.selectedOption === null) return;
            
            const currentQ = quizState.questions[quizState.currentQuestion];
            const isCorrect = quizState.selectedOption === currentQ.answer;
            
            // æ›´æ–°åˆ†æ•°
            if (isCorrect) {
                quizState.score++;
                playDingSound(); // ç­”å¯¹æ’­æ”¾éŸ³æ•ˆ
            }
            
            // æ˜¾ç¤ºå¯¹é”™åé¦ˆ
            document.querySelectorAll('.option-btn').forEach((btn, index) => {
                if (index === currentQ.answer) {
                    btn.classList.add('correct');
                } else if (index === quizState.selectedOption && !isCorrect) {
                    btn.classList.add('incorrect');
                }
                btn.disabled = true;
            });
            
            // ç¦ç”¨æäº¤æŒ‰é’®
            const submitBtn = document.querySelector('.quiz-btn');
            if (submitBtn) submitBtn.disabled = true;
            
            // å»¶è¿Ÿåè¿›å…¥ä¸‹ä¸€é¢˜æˆ–æ˜¾ç¤ºç»“æœ
            setTimeout(() => {
                quizState.currentQuestion++;
                quizState.selectedOption = null;
                
                if (quizState.currentQuestion < quizState.questions.length) {
                    showQuizQuestion();
                } else {
                    quizState.quizCompleted = true;
                    showQuizResult();
                }
            }, 1500);
        }

        // é‡æ–°æŒ‘æˆ˜
        window.retryQuiz = function() {
            startQuiz();
        }

        // é‡ç½®æŠ½å¥–æ¬¡æ•°
        window.resetChances = function() {
            remainingChances = 3;
            elements.chanceCount.textContent = remainingChances;
            elements.quizModal.style.display = 'none';
            elements.resultText.textContent = "ğŸŠ æŠ½å¥–æ¬¡æ•°å·²é‡ç½®ä¸º3æ¬¡ï¼ç¥ä½ å¥½è¿ï¼";
            
            // æ’­æ”¾åº†ç¥éŸ³æ•ˆ
            playDingSound();
            
            // æ·»åŠ ä¸€ä¸ªçŸ­æš‚çš„é«˜å…‰æ•ˆæœ
            elements.chanceCount.style.color = '#FFD700';
            elements.chanceCount.style.textShadow = '0 0 10px #FFD700';
            setTimeout(() => {
                elements.chanceCount.style.color = '';
                elements.chanceCount.style.textShadow = '';
            }, 1000);
        }

        // å…³é—­ç­”é¢˜å¼¹çª—
        window.closeQuizModal = function() {
            elements.quizModal.style.display = 'none';
        }

        // ç”Ÿæˆåˆå§‹æ•°æ®
        function generateInitialData() {
            const now = new Date();
            
            // ç”Ÿæˆ20ä¸ªéšæœºä¸­å¥–è®°å½•
            for (let i = 0; i < 20; i++) {
                const randomNickname = nicknames[Math.floor(Math.random() * nicknames.length)];
                const randomPrize = prizes[Math.floor(Math.random() * prizes.length)];
                const timeOffset = i * 10 * 60 * 1000; // æ¯10åˆ†é’Ÿä¸€ä¸ª
                const recordTime = new Date(now.getTime() - timeOffset);
                
                const shortTime = `${recordTime.getHours().toString().padStart(2,'0')}:${recordTime.getMinutes().toString().padStart(2,'0')}`;
                
                winners.push({
                    name: randomNickname,
                    prize: randomPrize.name,
                    time: shortTime
                });
            }
            
            // éšæœºé€‰æ‹©å½“å‰ç”¨æˆ·ç½‘å
            currentUser = nicknames[Math.floor(Math.random() * nicknames.length)];
        }

        // åˆå§‹åŒ–
        function init() {
            initializePrizes();
            generateInitialData();
            updateWinnerList();
            updateHistoryDisplay();
            
            // è‡ªåŠ¨æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆä¼˜åŒ–ä½“éªŒï¼‰
            const playMusic = () => {
                try {
                    elements.bgMusic.volume = 0.5;
                    elements.bgMusic.play().then(() => {
                        console.log("éŸ³ä¹è‡ªåŠ¨æ’­æ”¾æˆåŠŸ");
                        isBgMusicOn = true;
                        updateMusicButton();
                    }).catch(e => {
                        console.log("éŸ³ä¹è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’");
                        isBgMusicOn = false;
                        updateMusicButton();
                        
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼Œç”¨æˆ·ç‚¹å‡»é¡µé¢åå°è¯•æ’­æ”¾
                        document.addEventListener('click', function tryPlayMusic() {
                            elements.bgMusic.play().then(() => {
                                isBgMusicOn = true;
                                updateMusicButton();
                                document.removeEventListener('click', tryPlayMusic);
                            });
                        }, { once: true });
                    });
                } catch (e) {
                    console.log("éŸ³ä¹æ’­æ”¾é”™è¯¯:", e);
                }
            };
            
            // å»¶è¿Ÿ1ç§’åå°è¯•æ’­æ”¾éŸ³ä¹
            setTimeout(playMusic, 1000);
        }

        // æ›´æ–°éŸ³ä¹æŒ‰é’®
        function updateMusicButton() {
            elements.bgMusicStatus.textContent = isBgMusicOn ? 'å¼€å¯' : 'å…³é—­';
            elements.bgMusicBtn.classList.toggle('active', isBgMusicOn);
        }

        // äº‹ä»¶ç›‘å¬
        elements.startLotteryBtn.addEventListener('click', startLottery);
        elements.bgMusicBtn.addEventListener('click', toggleBgMusic);
        elements.soundEffectBtn.addEventListener('click', toggleSoundEffect);
        elements.viewHistoryBtn.addEventListener('click', () => {
            elements.historyModal.style.display = 'flex';
        });
        elements.resetBtn.addEventListener('click', startQuiz);
        elements.closeModal.addEventListener('click', () => {
            elements.historyModal.style.display = 'none';
        });
        
        elements.historyModal.addEventListener('click', (e) => {
            if (e.target === elements.historyModal) {
                elements.historyModal.style.display = 'none';
            }
        });
        
        elements.quizModal.addEventListener('click', (e) => {
            if (e.target === elements.quizModal) {
                elements.quizModal.style.display = 'none';
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', init);
        
        // çª—å£è°ƒæ•´å¤§å°æ—¶é‡æ–°åˆå§‹åŒ–å¸ƒå±€
        window.addEventListener('resize', initializePrizes);
    </script>
</body>
</html>
